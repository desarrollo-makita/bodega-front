<div class="modal-backdrop" (click)="cerrarModal()"></div>

<div class="modal-container mat-elevation-z8">
  <header class="modal-header">
    <h3>Garantía</h3>
  </header>

<nav class="tabs">
  <button
    [class.active]="tabSeleccionada === 'general'"
    (click)="tabSeleccionada = 'general'">
    <span class="material-icons">info</span> Información General
  </button>

  <button
    [class.active]="tabSeleccionada === 'detalle'"
    (click)="tabSeleccionada = 'detalle'">
    <span class="material-icons">inventory_2</span> Detalle Repuestos
  </button>

  <button
    [class.active]="tabSeleccionada === 'anexos'"
    (click)="tabSeleccionada = 'anexos'">
    <span class="material-icons">attach_file</span> Anexos
  </button>
</nav>


  <section class="modal-body">
    <div *ngIf="tabSeleccionada === 'general'" class="tab-content">
      <div class="info-row" *ngFor="let dato of datosGenerales">
        <span class="label">{{ dato.label }}:</span>
        <span class="value" [ngClass]="dato.clase">{{ dato.value }}</span>
      </div>
    </div>
    <div *ngIf="tabSeleccionada === 'general' && (mostrarMotivos || mostrarComentarioRechazo)" class="tab-content">
      <label for="comentario" style="padding-top: 3%;"><strong>Motivos / Observaciones:</strong></label>
        <textarea
          id="comentario"
          [(ngModel)]="comentarios"
          (ngModelChange)="validarComentario(data)"
          placeholder="Motivos del rechazo......."
          rows="5"
          [disabled]="data.EstadoSAP === 'RECHAZADO'">
        </textarea>
    </div>

    <div *ngIf="isLoading" id="loader" class="overlay" style="margin-top: 10em;">
      <img src="../../../assets/img/loader-preview.svg" alt="loading" />
    </div>

    <div *ngIf="tabSeleccionada === 'general' && mostrarBotonesInferiores"  class="botones-acciones">
      <button 
        *ngIf="!mostrarBotonRechazar" 
        class="btn-aprobar" 
        (click)="aprobar()">
        {{botonAprobar}}
      </button>
      <button
       *ngIf="!mostrarBotonRechazar"
        class="btn-rechazar"
        [disabled]="mostrarMotivos && !comentarios.trim()"
        [ngClass]="{ 'disabled-btn': mostrarMotivos && !comentarios.trim() }"
        (click)="rechazar(data)">
        {{ botonRechazar }}
      </button>
      <button
        *ngIf="mostrarBotonRechazar"
        class="btn-rechazar"
        [disabled]="mostrarMotivos && !comentarios.trim()"
        [ngClass]="{ 'disabled-btn': mostrarMotivos && !comentarios.trim() }"
        (click)="enviarRechazo(data)">
        Enviar Rechazo
      </button>
      <button
        *ngIf="mostrarBotonRechazar"
        (click)="cerrarModal()"
        type="button"
        class="btn-aprobar" 
        data-bs-dismiss="modal">
        Cancelar
       
      </button>

    </div>
    
    <div *ngIf="tabSeleccionada === 'detalle'" class="tab-content">
      <table>
        <thead>
          <tr>
            <th>Item</th>
            <th>Cantidad</th>
            <th>Descripción</th>
            <th>Ubicación</th>
            <th>Stock</th>
            <th>Bodega</th>
            
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let repuesto of data.detalle">
            <td>{{ repuesto.itemRepuesto }}</td>
            <td>{{ repuesto.Cantidad }}</td>
            <td>{{ repuesto.Descripcion  }}</td>
            <td>{{ repuesto.Ubicacion }}</td>
            <td>{{ repuesto.StockFinal }}</td>
            <td>{{ repuesto.Bodega }}</td>
          
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="tabSeleccionada === 'anexos'" class="tab-content">
      <h4 style="margin-bottom: 1rem;">Documentos Adjuntos</h4>
      
      <div *ngIf="data.documentos && data.documentos.length > 0; else sinDocumentos">
        <ul>
          <li *ngFor="let doc of data.documentos">
           <a href="javascript:void(0)" (click)="abrir(doc)">
            <span class="material-icons">attach_file</span> Ver documento
          </a>
          </li>
        </ul>
      </div>

      <ng-template #sinDocumentos>
        <p>No se encontraron documentos adjuntos para esta garantía.</p>
      </ng-template>
    </div>

  </section>
</div>
